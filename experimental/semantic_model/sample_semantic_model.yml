version: "1.0"
connector: sqlite
description: "Demo semantic model for order analytics"

tables:
  customers:
    schema: main
    name: customers
    description: "Customer master data"
    dimensions:
      - name: customer_id
        type: integer
        primary_key: true
      - name: name
        type: string
      - name: region
        type: string
      - name: signup_date
        type: date

  products:
    schema: main
    name: products
    description: "Product catalog"
    dimensions:
      - name: product_id
        type: integer
        primary_key: true
      - name: name
        type: string
      - name: category
        type: string
    measures:
      - name: price
        type: decimal
        aggregation: avg
    filters:
      electronics_only:
        condition: "products.category = 'Electronics'"
        description: "Filter for electronics products"

  orders:
    schema: main
    name: orders
    description: "Customer orders"
    dimensions:
      - name: order_id
        type: integer
        primary_key: true
      - name: customer_id
        type: integer
      - name: order_date
        type: date
      - name: status
        type: string
      - name: channel
        type: string
    measures:
      - name: total_amount
        type: decimal
        aggregation: sum
    filters:
      completed_only:
        condition: "orders.status = 'completed'"
        description: "Completed orders only"

  order_items:
    schema: main
    name: order_items
    description: "Order line items"
    dimensions:
      - name: order_item_id
        type: integer
        primary_key: true
      - name: order_id
        type: integer
      - name: product_id
        type: integer
    measures:
      - name: quantity
        type: integer
        aggregation: sum
      - name: unit_price
        type: decimal
        aggregation: avg
      - name: line_total
        type: decimal
        aggregation: sum

relationships:
  - name: orders_to_customers
    from_: orders
    to: customers
    type: many_to_one
    join_on: "orders.customer_id = customers.customer_id"

  - name: items_to_orders
    from_: order_items
    to: orders
    type: many_to_one
    join_on: "order_items.order_id = orders.order_id"

  - name: items_to_products
    from_: order_items
    to: products
    type: many_to_one
    join_on: "order_items.product_id = products.product_id"

metrics:
  total_revenue:
    description: "Total revenue from line items"
    expression: "SUM(order_items.line_total)"
  avg_order_value:
    description: "Average order total"
    expression: "AVG(orders.total_amount)"
  orders_count:
    description: "Total number of orders"
    expression: "COUNT(DISTINCT orders.order_id)"
  unique_customers:
    description: "Unique customers placing orders"
    expression: "COUNT(DISTINCT orders.customer_id)"
