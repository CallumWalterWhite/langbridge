version: '1.0'
database: sales
description: "Retail sales data model for stores and products"

tables:
  customers:
    description: "Customer information"
    dimensions:
      - name: customer_id
        type: integer
        primary_key: true
      - name: name
        type: string
        description: "Customer full name"
      - name: email
        type: string
      - name: phone
        type: string
      - name: join_date
        type: date
        description: "Date when customer joined"

  shops:
    description: "Store locations information"
    synonyms:
      - "stores"
      - "retail locations"
    dimensions:
      - name: shop_id
        alias: id
        type: integer
        primary_key: true
        synonyms:
          - "store_id"
      - name: shop_name
        alias: name
        type: string
        description: "Name of the shop"
        synonyms:
          - "store name"
          - "store location"
      - name: location
        alias: address
        type: string
      - name: manager
        type: string
    filters:
      mall_only:
        condition: "shop_name = 'Mall Shop'"
        description: "Filter for shops located in malls"
        synonyms:
          - "mall stores"
          - "shops in malls"
      downtown_only:
        condition: "shop_name = 'Downtown Store'"
        description: "Filter for shops located downtown"
        synonyms:
          - "downtown stores"
          - "city center shops"

  products:
    description: "Product catalog"
    dimensions:
      - name: product_id
        type: integer
        primary_key: true
        alias: id
        synonyms:
          - "product number"
          - "product id"
      - name: name
        type: string
        description: "Product name"
      - name: category
        type: string
    measures:
      - name: price
        type: decimal
        description: "Product unit price"
      - name: stock
        type: integer
        description: "Current inventory level"
    filters:
      electronics_only:
        condition: "category = 'Electronics'"
      accessories_only:
        condition: "category = 'Accessories'"

  sales:
    description: "Sales transactions"
    dimensions:
      - name: sale_id
        type: integer
        primary_key: true
      - name: sale_date
        type: date
        description: "Date of sale"
    measures:
      - name: quantity
        type: integer
        description: "Number of units sold"
      - name: total_amount
        type: decimal
        description: "Total sale amount"
        aggregation: sum

relationships:
  - name: sales_to_customers
    from: sales
    to: customers
    type: many_to_one
    join_on: "sales.customer_id = customers.customer_id"

  - name: sales_to_shops
    from: sales
    to: shops
    type: many_to_one
    join_on: "sales.shop_id = shops.shop_id"

  - name: sales_to_products
    from: sales
    to: products
    type: many_to_one
    join_on: "sales.product_id = products.product_id"

metrics:
  total_sales:
    description: "Total sales amount"
    expression: "SUM(sales.total_amount)"
    
  avg_transaction_value:
    description: "Average transaction value"
    expression: "AVG(sales.total_amount)"
    
  units_sold:
    description: "Total units sold"
    expression: "SUM(sales.quantity)"

  inventory_value:
    description: "Total inventory value"
    expression: "SUM(products.price * products.stock)"